<script>
  const chat = document.getElementById('chat');
  const form = document.getElementById('form');
  const input = document.getElementById('input');

  function append(text, role){
    const div = document.createElement('div');
    div.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const text = (input.value || '').trim();
    if (!text) return;

    // show user message
    append(text, 'user');
    input.value = '';

    // show thinking bubble
    append('Thinkingâ€¦', 'bot');
    const thinking = chat.lastElementChild;

    try {
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({ prompt: text })
      });

      if (!res.ok) {
        const err = await res.text();
        thinking.textContent = 'Error: ' + err;
      } else {
        const data = await res.json();
        thinking.textContent = data.reply || '(no reply)';
      }
    } catch (e) {
      thinking.textContent = 'Network error. Please try again.';
    }
  });
</script>

